<!-- Header / Navbar -->
<header id="site-header" class="bg-white shadow-md fixed top-0 left-0 right-0 z-[2000]">
    <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
        <!-- Logo -->
        <div class="flex items-center gap-3">
            <img src="/ico.png" alt="GreenDrop Logo" class="h-10 w-auto" />
            <a href="/" class="text-2xl font-bold brand-dark-green">GreenDrop</a>
        </div>

        <!-- Links desktop -->
        <ul class="hidden md:flex items-center space-x-8">
            <li><a href="/" class="font-medium text-gray-600 hover:brand-green transition-colors">In√≠cio</a></li>
            <li><a href="/#sobre-nos" class="font-medium text-gray-600 hover:brand-green transition-colors">Sobre
                    N√≥s</a></li>
            <li><a href="/#servicos" class="font-medium text-gray-600 hover:brand-green transition-colors">Servi√ßos</a>
            </li>
            <li><a href="/#mapa" class="font-medium text-gray-600 hover:brand-green transition-colors">Mapa</a></li>
            <li><a href="/ods" class="font-medium text-gray-600 hover:brand-green transition-colors">Metas da ONU</a>
            </li>
            <li><a href="/ranking" class="font-medium text-gray-600 hover:brand-green transition-colors">Ranking de Reciclagem</a>
            </li>
            <li><a href="/#contato" class="font-medium text-gray-600 hover:brand-green transition-colors">Contato</a>
            </li>
            <li>
                <a href="/notificacoes" class="relative group" aria-label="Notifica√ß√µes">
                    <i data-feather="bell" class="h-6 w-6 text-gray-600 group-hover:text-green-800 transition"></i>
                    <span
                        class="absolute bottom-0 right-0 flex items-center justify-center h-5 w-5 bg-red-600 text-white text-xs font-bold rounded-full shadow border border-white select-none translate-x-1/2 translate-y-1/2">3</span>
                </a>
            </li>
        </ul>

        <!-- A√ß√µes -->
        <div class="hidden md:flex items-center space-x-4">
            <a href="/login" class="font-medium text-gray-600 hover:brand-green transition-colors">Entrar</a>
            <a href="/register"
                class="py-2 px-4 rounded-lg font-medium text-white bg-brand-green hover:bg-brand-green-dark transition-transform duration-300 hover:scale-105">
                Cadastre-se
            </a>
        </div>

        <!-- Menu mobile -->
        <button class="md:hidden focus:outline-none" id="mobile-menu-button" aria-label="Abrir menu">
            <i data-feather="menu" class="h-6 w-6 text-gray-600"></i>
        </button>
    </nav>

    <!-- Drawer mobile -->
    <div class="hidden md:hidden border-t border-gray-100" id="mobile-menu">
        <ul class="px-4 py-3 space-y-1">
            <li><a href="/"
                    class="block px-3 py-2 rounded-md font-medium text-gray-700 hover:text-white hover:bg-brand-green">In√≠cio</a>
            </li>
            <li><a href="/#sobre-nos"
                    class="block px-3 py-2 rounded-md font-medium text-gray-700 hover:text-white hover:bg-brand-green">Sobre
                    N√≥s</a></li>
            <li><a href="/#servicos"
                    class="block px-3 py-2 rounded-md font-medium text-gray-700 hover:text-white hover:bg-brand-green">Servi√ßos</a>
            </li>
            <li><a href="/#mapa"
                    class="block px-3 py-2 rounded-md font-medium text-gray-700 hover:text-white hover:bg-brand-green">Mapa</a>
            </li>
            <li><a href="/#contato"
                    class="block px-3 py-2 rounded-md font-medium text-gray-700 hover:text-white hover:bg-brand-green">Contato</a>
            </li>
            <li><a href="/ods"
                    class="block px-3 py-2 rounded-md font-medium text-gray-700 hover:text-white hover:bg-brand-green">Metas
                    da ONU</a></li>
            <li><a href="/ranking"
                    class="block px-3 py-2 rounded-md font-medium text-gray-700 hover:text-white hover:bg-brand-green">Ranking
                    De Reciclagem</a></li>
            <li><a href="/notificacoes"
                    class="block px-3 py-2 rounded-md font-medium text-gray-700 hover:text-white hover:bg-brand-green">Notifica√ß√µes</a>
            </li>
            <li><a href="/login"
                    class="block px-3 py-2 rounded-md font-medium text-gray-700 hover:text-white hover:bg-brand-green">Entrar</a>
            </li>
            <li><a href="/register"
                    class="block px-3 py-2 rounded-md font-medium text-gray-700 hover:text-white hover:bg-brand-green">Cadastre-se</a>
            </li>
        </ul>
    </div>
</header>


<main>

    <!-- Hero Section -->
    <section class="bg-brand-off-white">
        <div class="container mx-auto px-6 py-20 md:py-32 text-center">
            <h1 class="text-4xl md:text-6xl font-bold brand-dark-green mb-12 leading-tight">
                Transformando o amanh√£,<br>uma gota de cada vez.
            </h1>
            <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto mb-8">
                Conectamos voc√™ aos pontos de coleta corretos para cada tipo de res√≠duo.
                Descubra lugares pr√≥ximos, receba orienta√ß√µes e fa√ßa o descarte consciente com praticidade.
            </p>
            <div class="flex flex-col md:flex-row items-center justify-center gap-4">
                <a href="/register"
                    class="w-full md:w-auto py-3 px-8 rounded-lg font-semibold text-white bg-brand-green hover:bg-brand-green-dark transition-all duration-300 transform hover:scale-105 shadow-lg text-center">
                    Comece Agora
                </a>
                <a href="#mapa"
                    class="w-full md:w-auto py-3 px-8 rounded-lg font-semibold text-white bg-brand-green hover:bg-brand-green-dark transition-all duration-300 transform hover:scale-105 shadow-lg text-center">
                    Veja no Mapa
                </a>
            </div>
        </div>
    </section>

    <!-- Features/Services Section -->
    <section id="servicos" class="section-padding">
        <!-- Cont√™iner da Anima√ß√£o de Fundo -->
        <div class="container mx-auto px-6 mb-12">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold brand-dark-green mb-12 pt-8">Nossos Servi√ßos</h2>
                <p class="mt-4 text-lg text-gray-600">Solu√ß√µes simples para um impacto real no planeta.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
                <!-- Feature 1 -->
                <div
                    class="text-center p-8 bg-white border border-gray-200 rounded-2xl shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <div
                        class="flex items-center justify-center h-16 w-16 rounded-full bg-brand-green text-white mx-auto mb-6">
                        <i data-feather="truck" class="h-8 w-8"></i>
                    </div>
                    <h3 class="text-xl font-bold brand-dark-green mb-3">Coleta Inteligente</h3>
                    <p class="text-gray-600">Encontre rapidamente o ponto de coleta ideal para cada material.
                        Use filtros por tipo de res√≠duo e visualize op√ß√µes no mapa em tempo real</p>
                </div>
                <!-- Feature 2 -->
                <div
                    class="text-center p-8 bg-white border border-gray-200 rounded-2xl shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <div
                        class="flex items-center justify-center h-16 w-16 rounded-full bg-brand-green text-white mx-auto mb-6">
                        <i data-feather="refresh-cw" class="h-8 w-8"></i>
                    </div>
                    <h3 class="text-xl font-bold  brand-dark-green mb-3">Reciclagem Eficiente</h3>
                    <p class="text-gray-600">Direcionamos seus res√≠duos para destinos adequados,
                        com informa√ß√µes claras sobre o que cada ponto aceita e hor√°rios de funcionamento.</p>
                </div>
                <!-- Feature 3 -->
                <div
                    class="text-center p-8 bg-white border border-gray-200 rounded-2xl shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <div
                        class="flex items-center justify-center h-16 w-16 rounded-full bg-brand-green text-white mx-auto mb-6">
                        <i data-feather="bar-chart-2" class="h-8 w-8"></i>
                    </div>
                    <h3 class="text-xl font-bold brand-dark-green mb-3">Relat√≥rio de Impacto</h3>
                    <p class="text-gray-600">Acompanhe quanto voc√™ j√° ajudou a reciclar.
                        Veja m√©tricas de materiais destinados corretamente e mantenha sua rotina sustent√°vel.</p>
                </div>
                <!-- Feature 4 -->
                <div
                    class="text-center p-8 bg-white border border-gray-200 rounded-2xl shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <div
                        class="flex items-center justify-center h-16 w-16 rounded-full bg-brand-green text-white mx-auto mb-6">
                        <i data-feather="book-open" class="h-8 w-8"></i>
                    </div>
                    <h3 class="text-xl font-bold brand-dark-green mb-3">Educa√ß√£o Ambiental</h3>
                    <p class="text-gray-600">Acesse dicas, listas do que pode ou n√£o reciclar e orienta√ß√µes para
                        descarte especial
                        (eletr√¥nicos, √≥leo, pilhas e mais).</p>
                </div>
            </div>
            <a href="./educativo"
                class="fixed top-1/2 right-0 transform -translate-y-1/2 bg-brand-green text-white px-4 py-3 rounded-l-full shadow-lg hover:bg-green-600 transition duration-300 flex items-center gap-2 z-50">
                <i data-feather="globe" class="h-5 w-5"></i> Guia de Reciclagem
            </a>

        </div>
    </section>

    <!-- About Us Section -->
    <section id="sobre-nos" class="section-padding mb-12 bg-brand-off-white">
        <div class="container mx-auto px-6">
            <div class="flex flex-col lg:flex-row items-center gap-12">
                <div class="lg:w-1/2">
                    <img src="/logo.png" alt="Imagem representando a miss√£o da GreenDrop"
                        class="rounded-2xl w-full h-auto object-cover">
                </div>
                <div class="lg:w-1/2 text-center lg:text-left">
                    <h2 class="text-3xl md:text-4xl font-bold brand-dark-green mb-6">Quem Somos</h2>
                    <p class="text-gray-600 text-lg mb-4">
                        A GreenDrop nasceu para tornar a sustentabilidade acess√≠vel no dia a dia.
                        Nosso prop√≥sito √© facilitar o descarte correto de res√≠duos, conectando pessoas a pontos de
                        coleta confi√°veis.
                    </p>
                    <p class="text-gray-600 text-lg mb-6">
                        Somos um projeto acad√™mico com foco em impacto socioambiental.
                        Constru√≠mos uma plataforma clara, √∫til e gratuita para que pequenos gestos gerem grandes
                        mudan√ßas.
                    </p>
                    <p class="text-gray-600 text-lg">
                        Projeto desenvolvido no √¢mbito universit√°rio, com tecnologia aberta e colabora√ß√£o da
                        comunidade.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Map Section -->
    <section id="mapa" class="section-padding pb-8">
        <div class="container mx-auto px-6">
            <div class="text-center mt-12 mb-12">
                <h1 class="text-4xl font-bold brand-dark-green mb-2 pt-8">Encontre Pontos de Coleta Perto de Voc√™ ‚ôªÔ∏è
                </h1>
                <p class="text-lg text-gray-600">Digite seu endere√ßo ou permita o acesso √† sua localiza√ß√£o para
                    visualizar os pontos de coleta mais pr√≥ximos.
                    <br />
                    <span class="text-green-700 font-medium">Filtre por tipo de material</span> e planeje sua rota
                    de descarte consciente.
                </p>
            </div>

            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Lista (opcional) -->
                <aside class="w-full lg:w-1/3 xl:w-1/4 bg-white p-6 rounded-2xl shadow-lg">
                    <h2 class="text-2xl font-bold brand-dark-green mb-2">
                        Buscar por endere√ßo, bairro ou CEP‚Ä¶
                    </h2>
                    <p class="text-gray-600 text-sm pb-4">
                        Dica: ative a localiza√ß√£o do navegador para resultados mais precisos.
                    </p>

                    <!-- Busca -->
                    <div class="flex gap-2 mb-4">
                        <input id="map-search" type="text" placeholder="Digite o endere√ßo ou bairro..."
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 ring-brand-green" />
                        <button id="btn-search"
                            class="bg-brand-green text-white px-3 rounded-lg hover:bg-brand-green-dark transition">üîç</button>
                    </div>

                    <!-- Select de material -->
                    <div class="mb-4">
                        <label for="map-filter-material" class="block text-sm font-semibold text-gray-700 mb-2">
                            Filtrar por tipo de material
                        </label>
                        <select id="map-filter-material"
                            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 ring-brand-green">
                            <option value="">Todos</option>
                            <option value="plastico">Pl√°stico</option>
                            <option value="papel">Papel</option>
                            <option value="vidro">Vidro</option>
                            <option value="metal">Metal</option>
                            <option value="organico">Org√¢nico</option>
                            <option value="eletronicos">Eletr√¥nicos</option>
                            <option value="baterias">Baterias</option>
                            <option value="oleo">√ìleo de cozinha</option>
                            <option value="isopor">Isopor</option>
                        </select>
                    </div>

                    <!-- Aberto agora -->
                    <label class="flex items-center gap-2 mb-3 cursor-pointer select-none">
                        <input id="map-open-now" type="checkbox" class="h-4 w-4">
                        <span class="text-sm font-semibold text-gray-700">Mostrar somente locais <span
                                class="text-emerald-700">abertos agora</span></span>
                    </label>

                    <!-- Chips (multi-sele√ß√£o) -->
                    <div class="flex items-center justify-between mb-2">
                        <strong class="text-gray-800">Filtrar por materiais</strong>
                        <button id="clearFilters" class="text-sm text-gray-600 hover:underline">Limpar</button>
                    </div>
                    <div id="chips" class="chips"></div>

                    <!-- Lista -->
                    <div id="locations-list" class="space-y-2 overflow-y-auto mt-4"
                        style="max-height: calc(40vh - 200px)"></div>
                </aside>



                <!-- Mapa -->
                <div class="w-full lg:w-2/3 xl:w-3/4 relative">
                    <div id="map" class="rounded-2xl shadow-2xl border border-green-100 h-[600px] lg:h-[720px]">
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- CTA Section -->
    <section class="bg-brand-off-white">
        <div class="container mx-auto px-6 py-16 text-center text-gray-600">
            <h2 class="text-3xl font-bold mb-4">Pronto para fazer a diferen√ßa?</h2>
            <p class="text-lg mb-8 max-w-2xl mx-auto">Crie sua conta gratuita e comece a transformar o mundo com a
                gente.</p>
            <a href="/register"
                class="inline-block py-3 px-8 mr-4 rounded-lg font-semibold text-white bg-brand-green hover:bg-brand-green-dark transition-all duration-300 transform hover:scale-105 shadow-lg">
                Junte-se a N√≥s
            </a>
        </div>
    </section>

</main>

<!-- Footer -->
<footer id="contato" class="text-gray-600 bg-white border border-t shadow-md">
    <div class="container mx-auto px-6 py-12">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
            <!-- About -->
            <div class="col-span-1 md:col-span-2">
                <h4 class="text-xl font-bold mb-4">GreenDrop</h4>
                <p class="text-gray-400">Promovendo a sustentabilidade atrav√©s da tecnologia, conectando pessoas a
                    solu√ß√µes de reciclagem eficientes.</p>
            </div>
            <!-- Links -->
            <div>
                <h4 class="text-lg font-semibold mb-4">Links R√°pidos</h4>
                <ul class="space-y-2">
                    <li><a href="#sobre-nos" class="text-gray-400 hover:text-green-800 transition-colors">Sobre</a>
                    </li>
                    <li><a href="#servicos" class="text-gray-400 hover:text-green-800 transition-colors">Servi√ßos</a>
                    </li>
                    <li><a href="#" class="text-gray-400 hover:text-green-800 transition-colors">FAQ</a></li>
                    <li><a href="#contato" class="text-gray-400 hover:text-green-800 transition-colors">Contato</a>
                    </li>
                </ul>
            </div>
            <!-- Social -->
            <div>
                <h4 class="text-lg font-semibold mb-4">Siga-nos</h4>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-400 hover:text-green-800"><i data-feather="facebook"></i></a>
                    <a href="#" class="text-gray-400 hover:text-green-800"><i data-feather="twitter"></i></a>
                    <a href="#" class="text-gray-400 hover:text-green-800"><i data-feather="instagram"></i></a>
                </div>
            </div>
        </div>
        <div class="mt-12 border-t border-gray-700 pt-8 text-center text-gray-500 text-sm">
            &copy; 2025 GreenDrop. Todos os direitos reservados.
        </div>
    </div>
</footer>

<!-- Modal de Avalia√ß√µes -->
<div id="reviews-modal" class="reviews-modal hidden">
    <div class="reviews-modal-overlay" onclick="closeReviewsModal()"></div>
    <div class="reviews-modal-content">
        <div class="reviews-modal-header">
            <h2 id="modal-point-name" class="text-xl font-bold">Avalia√ß√µes</h2>
            <button onclick="closeReviewsModal()" class="close-btn">&times;</button>
        </div>
        <div class="reviews-modal-body">
            <div id="modal-rating-section" class="mb-4">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-sm text-gray-600">Avaliar:</span>
                    <div id="modal-rating-stars" class="rating-stars interactive">
                        <span class="star" data-rating="1">‚òÖ</span>
                        <span class="star" data-rating="2">‚òÖ</span>
                        <span class="star" data-rating="3">‚òÖ</span>
                        <span class="star" data-rating="4">‚òÖ</span>
                        <span class="star" data-rating="5">‚òÖ</span>
                    </div>
                </div>
                <textarea id="modal-review-comment" class="w-full p-2 border border-gray-300 rounded-md text-sm"
                    rows="3" placeholder="Deixe um coment√°rio (opcional)"></textarea>
                <button id="modal-submit-review"
                    class="mt-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm font-semibold">Enviar
                    Avalia√ß√£o</button>
            </div>
            <div id="modal-reviews-list" class="reviews-list"></div>
        </div>
    </div>
</div>

<script>
    // Fun√ß√£o global para renderizar estrelas
    window.renderStars = function (rating, interactive = false) {
        const stars = [];
        const fullStars = Math.floor(rating);
        const hasHalfStar = rating % 1 >= 0.5;
        for (let i = 1; i <= 5; i++) {
            let starClass = '';
            if (i <= fullStars) {
                starClass = 'active';
            } else if (i === fullStars + 1 && hasHalfStar) {
                starClass = 'active';
            }
            stars.push(`<span class="star ${starClass}" ${interactive ? `data-rating="${i}"` : ''} style="color: ${starClass ? '#fbbf24' : '#d1d5db'}; font-size: 16px; cursor: ${interactive ? 'pointer' : 'default'};">‚òÖ</span>`);
        }
        return `<div style="display: inline-flex; gap: 2px;">${stars.join('')}</div>`;
    };

    // ------ Modal de Avalia√ß√µes ------
    let currentPontoId = null;
    let currentRating = 0;

    window.openReviewsModal = async function (pontoId, pointName) {
        currentPontoId = pontoId;
        document.getElementById('modal-point-name').textContent = `${pointName} - Avalia√ß√µes`;
        document.getElementById('reviews-modal').classList.remove('hidden');

        // Resetar estrelas
        const stars = document.querySelectorAll('#modal-rating-stars .star');
        stars.forEach(s => {
            s.classList.remove('active');
            s.style.color = '#d1d5db';
        });
        currentRating = 0;

        // Carregar avalia√ß√µes
        await loadReviews(pontoId);

        // Bind eventos das estrelas
        bindModalStarEvents();
        bindSubmitReview();
    };

    window.closeReviewsModal = function () {
        document.getElementById('reviews-modal').classList.add('hidden');
        currentPontoId = null;
        currentRating = 0;
    };

    function bindModalStarEvents() {
        const stars = document.querySelectorAll('#modal-rating-stars .star');
        stars.forEach((star, index) => {
            star.onclick = () => {
                const rating = index + 1;
                currentRating = rating;
                stars.forEach((s, i) => {
                    if (i < rating) {
                        s.classList.add('active');
                        s.style.color = '#fbbf24';
                    } else {
                        s.classList.remove('active');
                        s.style.color = '#d1d5db';
                    }
                });
            };
        });
    }

    function bindSubmitReview() {
        const submitBtn = document.getElementById('modal-submit-review');
        if (submitBtn.onclick) return; // J√° bindado

        submitBtn.onclick = async () => {
            if (!currentRating) {
                alert('Por favor, selecione uma nota');
                return;
            }

            try {
                const comentario = document.getElementById('modal-review-comment').value;
                const response = await fetch('/api/reviews', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({
                        pontoColetaId: currentPontoId,
                        nota: currentRating,
                        comentario: comentario || null
                    })
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        alert('Voc√™ precisa estar logado para avaliar');
                        return;
                    }
                    throw new Error('Erro ao enviar avalia√ß√£o');
                }

                // Recarregar avalia√ß√µes e atualizar lista de pontos
                await loadReviews(currentPontoId);
                document.getElementById('modal-review-comment').value = '';
                currentRating = 0;
                const stars = document.querySelectorAll('#modal-rating-stars .star');
                stars.forEach(s => {
                    s.classList.remove('active');
                    s.style.color = '#d1d5db';
                });

                // Recarregar p√°gina ou atualizar mapa
                if (typeof renderLocations === 'function') {
                    // Recarregar pontos se a fun√ß√£o existir
                    const resp = await fetch('/api/pontos', { cache: 'no-store' });
                    if (resp.ok) {
                        const pontos = await resp.json();
                        // Atualizar locations e re-renderizar
                        if (window.locations) {
                            window.locations = pontos.map(p => ({
                                id: p.id,
                                name: p.name || p.nome || 'Ponto de Coleta',
                                address: p.address || p.endereco || '',
                                lat: parseFloat(p.lat || p.latitude),
                                lng: parseFloat(p.lng || p.longitude),
                                materials: Array.isArray(p.materials) ? p.materials : [],
                                horario: p.horario || p.horarioFuncionamento || '',
                                rating: p.rating || 0,
                                totalReviews: p.totalReviews || 0
                            }));
                            location.reload(); // Recarregar p√°gina para atualizar tudo
                        }
                    }
                } else {
                    location.reload(); // Recarregar p√°gina
                }
            } catch (error) {
                console.error('Erro ao enviar avalia√ß√£o:', error);
                alert('Erro ao enviar avalia√ß√£o. Tente novamente.');
            }
        };
    }

    async function loadReviews(pontoId) {
        try {
            const response = await fetch(`/api/reviews/ponto/${pontoId}`);
            const reviews = await response.json();

            const reviewsList = document.getElementById('modal-reviews-list');
            if (!reviews || reviews.length === 0) {
                reviewsList.innerHTML = '<p class="text-sm text-gray-500 text-center py-4">Ainda n√£o h√° avalia√ß√µes para este ponto.</p>';
                return;
            }

            reviewsList.innerHTML = reviews.map(review => {
                const user = review.user || {};
                const userName = user.name || 'Usu√°rio An√¥nimo';
                const userInitial = userName.charAt(0).toUpperCase();
                const date = new Date(review.createdAt);
                const timeAgo = getTimeAgo(date);
                const starsHtml = window.renderStars(review.nota, false);

                return `
                    <div class="review-item">
                        <div class="review-header">
                            <div class="review-avatar">${userInitial}</div>
                            <div class="review-info">
                                <div class="review-author">${userName}</div>
                                <div class="review-date">${timeAgo}</div>
                            </div>
                        </div>
                        <div class="review-rating">${starsHtml}</div>
                        ${review.comentario ? `<div class="review-comment">${review.comentario}</div>` : ''}
                    </div>
                `;
            }).join('');
        } catch (error) {
            console.error('Erro ao carregar avalia√ß√µes:', error);
            document.getElementById('modal-reviews-list').innerHTML = '<p class="text-sm text-red-500 text-center py-4">Erro ao carregar avalia√ß√µes.</p>';
        }
    }

    function getTimeAgo(date) {
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);
        const diffMonths = Math.floor(diffDays / 30);
        const diffYears = Math.floor(diffDays / 365);

        if (diffMins < 1) return 'Agora';
        if (diffMins < 60) return `${diffMins} minuto${diffMins > 1 ? 's' : ''} atr√°s`;
        if (diffHours < 24) return `${diffHours} hora${diffHours > 1 ? 's' : ''} atr√°s`;
        if (diffDays < 30) return `${diffDays} dia${diffDays > 1 ? 's' : ''} atr√°s`;
        if (diffMonths < 12) return `${diffMonths} m√™s${diffMonths > 1 ? 'es' : ''} atr√°s`;
        return `${diffYears} ano${diffYears > 1 ? 's' : ''} atr√°s`;
    }
</script>

<style>
    .rating-stars {
        display: inline-flex;
        gap: 2px;
        font-size: 18px;
        color: #d1d5db;
        cursor: pointer;
    }

    .rating-stars .star {
        transition: color .15s ease;
        user-select: none;
    }

    .rating-stars .star.active {
        color: #fbbf24;
    }

    .rating-stars.interactive .star:hover {
        color: #fbbf24;
    }

    .reviews-modal {
        position: fixed;
        inset: 0;
        z-index: 2000;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .reviews-modal.hidden {
        display: none;
    }

    .reviews-modal-overlay {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, .5);
        backdrop-filter: blur(2px);
    }

    .reviews-modal-content {
        position: relative;
        background: #fff;
        border-radius: 16px;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        box-shadow: 0 20px 40px rgba(0, 0, 0, .2);
    }

    .reviews-modal-header {
        padding: 20px;
        border-bottom: 1px solid #E5E7EB;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .reviews-modal-body {
        padding: 20px;
        overflow-y: auto;
        flex: 1;
    }

    .close-btn {
        width: 32px;
        height: 32px;
        border: 0;
        background: transparent;
        font-size: 24px;
        cursor: pointer;
        color: #6B7280;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background .2s ease;
    }

    .close-btn:hover {
        background: #f3f4f6;
        color: #111827;
    }

    .reviews-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .review-item {
        padding: 16px;
        background: #f9fafb;
        border-radius: 10px;
        border: 1px solid #E5E7EB;
    }

    .review-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 8px;
    }

    .review-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #34A853;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 16px;
    }

    .review-info {
        flex: 1;
    }

    .review-author {
        font-weight: 600;
        color: #111827;
        font-size: 14px;
    }

    .review-date {
        font-size: 12px;
        color: #6B7280;
    }

    .review-rating {
        margin: 8px 0;
    }

    .review-comment {
        font-size: 14px;
        color: #374151;
        line-height: 1.5;
    }
</style>